{"ast":null,"code":"import * as d3 from \"d3\";\nimport { useStore } from 'react-redux';\nexport function runForceGraph(container, linksData, nodesData) {\n  const store = useStore();\n  const links = linksData.map(d => Object.assign({}, d));\n  const nodes = nodesData.map(d => Object.assign({}, d));\n  const containerRect = container.getBoundingClientRect();\n  const height = containerRect.height;\n  const width = containerRect.width;\n\n  const drag = simulation => {\n    const dragstarted = d => {\n      if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    };\n\n    const dragged = d => {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    };\n\n    const dragended = d => {\n      if (!d3.event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    };\n\n    return d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended);\n  }; // Add the tooltip element to the graph\n\n\n  const tooltip = document.querySelector(\"#graph-tooltip\");\n\n  if (!tooltip) {\n    const tooltipDiv = document.createElement(\"div\");\n    tooltipDiv.style.opacity = \"0\";\n    tooltipDiv.id = \"graph-tooltip\";\n    document.body.appendChild(tooltipDiv);\n  }\n\n  const getNodeColor = node => {\n    //return node.name === this.props.parent.data ? 'red' : '#0099ff'\n    return '#0099ff';\n  };\n\n  const simulation = d3.forceSimulation(nodes).force(\"link\", d3.forceLink(links).id(d => d.id)).force(\"charge\", d3.forceManyBody().strength(-150)).force(\"x\", d3.forceX()).force(\"y\", d3.forceY());\n  const svg = d3.select(container).append(\"svg\").attr(\"viewBox\", [-width / 2, -height / 2, width, height]).call(d3.zoom().on(\"zoom\", function () {\n    svg.attr(\"transform\", d3.event.transform);\n  }));\n  const link = svg.append(\"g\").attr(\"stroke\", \"#aaa\").attr(\"stroke-opacity\", 0.6).selectAll(\"line\").data(links).join(\"line\").attr(\"stroke-width\", function (d) {\n    return Math.sqrt(d.value) / 10;\n  });\n  const node = svg.append(\"g\").attr(\"stroke\", \"#aaa\").attr(\"stroke-width\", 2).selectAll(\"circle\").data(nodes).join(\"circle\").attr(\"r\", function (d) {\n    return Math.sqrt(d.pubs) * 1.5;\n  }).attr(\"fill\", getNodeColor).call(drag(simulation));\n  node.append(\"title\").text(function (d) {\n    let dc = '';\n    let name = ';';\n\n    if (d.name.indexOf('*') !== -1) {\n      name = d.name.replace('*', '');\n      dc = ' (DECEASED)';\n    } else {\n      name = d.name;\n    }\n\n    name = name.concat(dc);\n    let text = name.concat(\"\\n \");\n    text = text.concat(d.pubs);\n    text = text.concat(\" Coauthor(s) with Erdos number 2\");\n    return text;\n  });\n  simulation.on(\"tick\", () => {\n    //update link positions\n    link.attr(\"x1\", d => d.source.x).attr(\"y1\", d => d.source.y).attr(\"x2\", d => d.target.x).attr(\"y2\", d => d.target.y); // update node positions\n\n    node.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\n  });\n  return {\n    destroy: () => {\n      simulation.stop();\n    },\n    nodes: () => {\n      return svg.node();\n    }\n  };\n}","map":{"version":3,"sources":["/Users/peterstephens/Documents/projects/erdos_number/erdos_display/src/components/ForceGraphGenerator.js"],"names":["d3","useStore","runForceGraph","container","linksData","nodesData","store","links","map","d","Object","assign","nodes","containerRect","getBoundingClientRect","height","width","drag","simulation","dragstarted","event","active","alphaTarget","restart","fx","x","fy","y","dragged","dragended","on","tooltip","document","querySelector","tooltipDiv","createElement","style","opacity","id","body","appendChild","getNodeColor","node","forceSimulation","force","forceLink","forceManyBody","strength","forceX","forceY","svg","select","append","attr","call","zoom","transform","link","selectAll","data","join","Math","sqrt","value","pubs","text","dc","name","indexOf","replace","concat","source","target","destroy","stop"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport { useStore } from 'react-redux'\n\nexport function runForceGraph(container, linksData, nodesData) {\n\n    const store = useStore();\n\n    const links = linksData.map((d) => Object.assign({}, d));\n    const nodes = nodesData.map((d) => Object.assign({}, d));\n\n    const containerRect = container.getBoundingClientRect();\n    const height = containerRect.height;\n    const width = containerRect.width;\n\n    const drag = (simulation) => {\n    const dragstarted = (d) => {\n        if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n        d.fx = d.x;\n        d.fy = d.y;\n    };\n\n    const dragged = (d) => {\n        d.fx = d3.event.x;\n        d.fy = d3.event.y;\n    };\n\n    const dragended = (d) => {\n        if (!d3.event.active) simulation.alphaTarget(0);\n        d.fx = null;\n        d.fy = null;\n    };\n\n    return d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended);\n    };\n\n    // Add the tooltip element to the graph\n    const tooltip = document.querySelector(\"#graph-tooltip\");\n    if (!tooltip) {\n        const tooltipDiv = document.createElement(\"div\");\n        tooltipDiv.style.opacity = \"0\";\n        tooltipDiv.id = \"graph-tooltip\";\n        document.body.appendChild(tooltipDiv);\n    }\n\n    const getNodeColor = (node) => {\n    //return node.name === this.props.parent.data ? 'red' : '#0099ff'\n    return('#0099ff')\n    }\n\n    const simulation = d3.forceSimulation(nodes)\n                         .force(\"link\", d3.forceLink(links).id(d => d.id))\n                         .force(\"charge\", d3.forceManyBody().strength(-150))\n                         .force(\"x\", d3.forceX())\n                         .force(\"y\", d3.forceY());\n\n    const svg = d3.select(container)\n                  .append(\"svg\")\n                  .attr(\"viewBox\", [-width / 2, -height / 2, width, height])\n                  .call(d3.zoom().on(\"zoom\", function () {\n                        svg.attr(\"transform\", d3.event.transform);})\n                  );\n\n    const link = svg.append(\"g\")\n                    .attr(\"stroke\", \"#aaa\")\n                    .attr(\"stroke-opacity\", 0.6)\n                    .selectAll(\"line\")\n                    .data(links)\n                    .join(\"line\")\n                    .attr(\"stroke-width\", function(d) { return Math.sqrt(d.value) / 10; });\n\n    const node = svg.append(\"g\")\n                    .attr(\"stroke\", \"#aaa\")\n                    .attr(\"stroke-width\", 2)\n                    .selectAll(\"circle\")\n                    .data(nodes)\n                    .join(\"circle\")\n                    .attr(\"r\", function(d) {\n                        return Math.sqrt(d.pubs)*1.5;\n                    })\n                    .attr(\"fill\", getNodeColor)\n                    .call(drag(simulation));\n\n    node.append(\"title\")\n        .text(function(d) {\n            let dc = '';\n            let name = ';'\n            if (d.name.indexOf('*') !== -1) {\n                name = d.name.replace('*', '');\n                dc = ' (DECEASED)';\n            }\n            else {\n                name = d.name;\n            }\n            name = name.concat(dc);\n            let text = name.concat(\"\\n \");\n            text = text.concat(d.pubs);\n            text = text.concat(\" Coauthor(s) with Erdos number 2\");\n            return text;\n    });\n\n    simulation.on(\"tick\", () => {\n        //update link positions\n        link.attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n\n        // update node positions\n        node.attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n    });\n\n    return {\n        destroy: () => {\n            simulation.stop();\n        },\n        nodes: () => {\n            return svg.node();\n        }\n    };\n}\n"]},"metadata":{},"sourceType":"module"}